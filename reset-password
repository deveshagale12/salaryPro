<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Reset Password | SalaryPro</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>

        body {

            background: linear-gradient(135deg, #f8f9fd 0%, #e9ecef 100%);

            font-family: 'Inter', sans-serif;

            height: 100vh;

        }

        .reset-card {

            border: none;

            border-radius: 24px;

            box-shadow: 0 20px 40px rgba(0,0,0,0.08);

            background: white;

        }

        .btn-primary {

            background: #4361ee;

            border: none;

            padding: 12px;

            border-radius: 12px;

            font-weight: 600;

        }

        .form-control {

            border-radius: 12px;

            padding: 12px;

            border: 1px solid #e0e6ed;

            background-color: #fbfcfe;

        }

    </style>

</head>

<body class="d-flex align-items-center">



    <div class="container">

        <div class="card reset-card mx-auto p-4" style="max-width: 420px;">

            <div class="card-body">

                <div class="text-center mb-4">

                    <div class="icon-box mb-3">

                        <i class="bi bi-shield-lock-fill text-primary fs-1"></i>

                    </div>

                    <h2 class="fw-800 text-dark mb-1">New Password</h2>

                    <p class="text-muted small">Please choose a strong password you haven't used before.</p>

                </div>

                

                <form id="resetForm">

                    <div class="mb-3">

                        <label class="form-label small fw-bold text-muted">New Password</label>

                        <input type="password" id="newPassword" class="form-control" placeholder="••••••••" required>

                    </div>

                    

                    <div class="mb-4">

                        <label class="form-label small fw-bold text-muted">Confirm Password</label>

                        <input type="password" id="confirmPassword" class="form-control" placeholder="••••••••" required>

                        <div id="matchError" class="text-danger small mt-1 d-none">Passwords do not match</div>

                    </div>



                    <button type="submit" id="resetBtn" class="btn btn-primary w-100 shadow-sm">

                        Update Password

                    </button>

                    

                    <div id="statusMsg" class="alert d-none mt-3 small text-center py-2"></div>

                </form>

            </div>

        </div>

    </div>



    <script>

    document.getElementById('resetForm').onsubmit = async (e) => {

        e.preventDefault();

        const btn = document.getElementById('resetBtn');

        const msg = document.getElementById('statusMsg');

        const pass = document.getElementById('newPassword').value;

        const confirm = document.getElementById('confirmPassword').value;

        const matchError = document.getElementById('matchError');



        // 1. Client-side Validation

        if(pass !== confirm) {

            matchError.classList.remove('d-none');

            return;

        } else {

            matchError.classList.add('d-none');

        }



        // 2. Get Token from URL (e.g., reset-password.html?token=xyz123)

        const urlParams = new URLSearchParams(window.location.search);

        const token = urlParams.get('token');



        if(!token) {

            msg.className = "alert alert-danger d-block";

            msg.innerText = "Invalid or missing reset token.";

            return;

        }



        btn.disabled = true;

        btn.innerText = "Updating...";



        try {

            const res = await fetch('/api/users/reset-password', {

                method: 'POST',

                headers: {'Content-Type': 'application/json'},

                body: JSON.stringify({ token, newPassword: pass })

            });



            if(res.ok) {

                msg.className = "alert alert-success d-block";

                msg.innerText = "Password updated! Redirecting to login...";

                setTimeout(() => window.location.href = 'login.html', 3000);

            } else {

                throw new Error("Failed");

            }

        } catch (err) {

            msg.className = "alert alert-danger d-block";

            msg.innerText = "Link expired or invalid. Please request a new one.";

            btn.disabled = false;

            btn.innerText = "Update Password";

        }

    };

    </script>

</body>

</html>